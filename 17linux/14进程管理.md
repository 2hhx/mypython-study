# 进程管理

## 1 基本介绍

```
1.在 LINUX 中，每个执行的程序（代码）都称为一个进程。每一个进程都分配一个 ID 号
2.每一个进程，都会对应一个父进程，而这个父进程可以复制多个子进程
3.每个进程都可能以两种方式存在的。前台与后台，所谓前台进程就是用户目前的屏幕上可以进行操作的。后台进程则是实际在操作，但由于屏幕上无法看到的进程，通常使用后台方式执行
4.一般系统的服务都是以后台进程的方式存在，而且都会常驻在系统中。直到关机才才结束
```



## 2 显示系统执行的进程

### 2.1 说明

查看进行使用的指令是     ps ,一般来说使用的参数是 `ps -aux`,`ps -ef`,正常与`grep`连用

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122757326-1302997190.png)

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122759893-1104192787.png)



### 2.2 ps指令详解

**BSD风格 详解**`ps -aux`

```
user 			用户名称
pid				进程号
%cpu			进程占用cpu百分比
%%mem			进程占用物理内存的百分比
vsz				进程占用虚拟内存的大小
rss				进程占用物理内存的大小
tty				终端名称(后台则为?)
stat			进程状态
	S:睡眠
	s:会话的先导进程
	N:进程拥有比普通优先级更低的优先级
	R:正在运行
	D:短期等待
	Z:僵尸进程
	T:被跟踪或者被停止
start			进程启动时间
time			使用cpu总时间
command			启动进程所用的命令和参数，如果过长会被截断显示
```

**system V 风格详解**`ps -ef`

```
uid 			用户id
pid				进程id
ppid			父进程id
C				进程占cpu百分比
stime			进程启动时间
tty				终端名称(后台则为?)
cmd				启动进程所用的命令和参数
```



```
例子:
1.查看sshd进程的父进程id是多少
	ps -ef | grep sshd
```





## 3 终止进程kill和killall

### 3.1 说明

若是某个进程执行一半需要停止时，或是已消了很大的系统资源时，此时可以考虑停止该进程。



### 3.2 基本语法:

```
kill 进程号
	-9 强迫进程立即停止
killall 进程名称
```



### 3.4 例子

```
1.踢掉某个非法登录用户
	ps -ef|	grep sshd
	kill 进程号
2.终止远程登录服务
	kill 进程号
	service sshd status 查看状态
	service sshd start 开启服务
	
sshd, 在适当时候再次重启
sshd 服务

3.终止多个 gedit  编辑器 【killall
,  通过进程名称来终止进程】
	gedit 是开启一个编辑框
	killall gedit 杀死gedit
4.强制杀掉一个终端
	bash -> 终端
	ps -ef | grep bash
	kill 进程号
	kill -9 进程号			-9强杀
	kill 进程号  可以杀死自己
```





## 4 查看进程树 pstree

```
pstree [选项]
	-p    查看进程pid
	-u	  查看进程所属用户
	
```





## 5 服务(service)管理

### 5.1 说明

服务(service) 本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其它程序的请求，比如(mysql , sshd 防火墙等)，因此我们又称为守护进程，是
Linux 中非常重要的知识点。

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122822813-1375206275.png)



### 5.2 基本使用

临时生效

```
service 服务名 [start | stop | restart | reload | status]
```



### 5.3 例子

1.查看当前防火墙的状况，关闭防火墙和重启防火墙(iptables)

`service iptables status`

`service iptables stop`

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122829354-1014059202.png)



**service这种方式关闭或者打开服务只是临时生效**

**重启后,还是回到以前对服务的设置**



### 5.4 查看服务名

/etc/init.d    此文件夹下放着系统都有哪些服务

```
ls -l /etc/init.d
```

所有的服务都在里面

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122832640-1576583371.png)



### 5.5 服务器运行级别(runlevel)

```
查看或者修改默认级别：	vi /etc/inittab
```

Linux 系统有 7 种运行级别(runlevel)：常用的是级别 3 和 5

运行级别 0：系统停机状态，系统默认运行级别不能设为 0，否则不能正常启动

运行级别 1：单用户工作状态，root 权限，用于系统维护，禁止远程登陆

运行级别 2：多用户状态(没有 NFS)，不支持网络

运行级别 3：完全的多用户状态(有 NFS)，登陆后进入控制台命令行模式

运行级别 4：系统未使用，保留

运行级别 5：X11 控制台，登陆后进入图形 GUI 模式

运行级别 6：系统正常关闭并重启，默认运行级别不能设为 6，否则不能正常启动



### 5.6 开机流程说明

![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122840441-973637992.png)



### 5.7 chkconfig指令

#### 5.7.1 说明

通过 chkconfig 命令可以给每个服务的各个运行级别设置自启动/关闭



#### 5.7.2 基本语法

```
chkconfig							  查看每个服务的配置
chkconfig --list 服务名	  					查看具体服务的配置
chkconfig --level 5 服务名  on/off     给服务设置是否自动启动 on开启
```

```
chkconfig | grep sshd
或者
chkconfig --list sshd
```



#### 5.7.3 例子

```
1.请显示当前系统所有服务的各个运行级别的运行状态
	chkconfig
2.请查看 sshd 服务的运行状态
	chkconfig --list sshd
	chkconfig |grep sshd
3.将 sshd 服务在运行级别 5 下设置为不自动启动，看看有什么效果？
	chkconfig --level 5 sshd off
4.当运行级别为 5 时，关闭防火墙。
	chkconfig --level 5 iptables off
5.在所有运行级别下，关闭防火墙
	chkconfig iptables off
6.在所有运行级别下，开启防火墙
	chkconfig iptables on
	
	
	
	service sshd start
```



**chkconfig 重新设置服务后自启动或关闭，需要重启机器
reboot
才能生效**



## 6 动态监控进程

### 6.1 说明

top
与 ps 命令很相似。它们都用来显示正在执行的进程。Top 与 ps 最大的不同之处，在于
top 在执行一段时间可以更新正在运行的的进程

### 6.2 基本语法

```
top [选项]
	-d			指定每隔几秒更新,默认3秒
	-i			不显示任何闲置或者僵尸进程
	-p id号		监听指定进程


交互操作:
P		以cpu使用率排序,默认就这个
M		以内存使用率排序
N		以pid排序
u		监听具体用户
k		终止指定进程
q		退出top
```



![](https://img2018.cnblogs.com/blog/1739658/202001/1739658-20200109122842992-929059516.png)

### 6.3 例子

```
1.监视特定用户
2.终止指定的进程
3.指定系统状态更新的时间(每隔 10 秒自动更新， 默认是 3 秒)
```

